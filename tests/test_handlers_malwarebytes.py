from handlers.malwarebytes import Malwarebytes


def test_mwb_validate_signature(flaskapp):
    # Test without the proper MWB header X-MWB-Signature
    with flaskapp.test_request_context(
        "/url", method="POST", headers={"X-Adypta": "Nothing"}, json={"coffee": "black"}
    ) as rc:
        result = Malwarebytes().validate_signature(rc.request)
        assert result == False

    # Test with the proper header.
    with flaskapp.test_request_context(
        "/url",
        method="POST",
        headers={
            "X-MWB-Signature": "7071849EEFB8E14B827183AB54358B5EA485D6B3065623CA85EE03446371A3B4"
        },
        data='{"coffee": "black"}',
    ) as rc:
        result = Malwarebytes().validate_signature(rc.request)
        assert result == True
